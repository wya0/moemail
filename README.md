<p align="center">
  <img src="public/icons/icon-192x192.png" alt="MoeMail Logo" width="100" height="100">
  <h1 align="center">MoeMail</h1>
</p>

<p align="center">
  ä¸€ä¸ªåŸºäº NextJS + Cloudflare æŠ€æœ¯æ ˆæ„å»ºçš„å¯çˆ±ä¸´æ—¶é‚®ç®±æœåŠ¡ğŸ‰
</p>

<p align="center">
  <a href="./README.md">ç®€ä½“ä¸­æ–‡</a> | 
  <a href="./README.en.md">English</a> 
</p>

<p align="center">
  <a href="#åœ¨çº¿æ¼”ç¤º">åœ¨çº¿æ¼”ç¤º</a> â€¢
  <a href="#æ–‡æ¡£">æ–‡æ¡£</a> â€¢
  <a href="#ç‰¹æ€§">ç‰¹æ€§</a> â€¢
  <a href="#æŠ€æœ¯æ ˆ">æŠ€æœ¯æ ˆ</a> â€¢
  <a href="#æœ¬åœ°è¿è¡Œ">æœ¬åœ°è¿è¡Œ</a> â€¢
  <a href="#éƒ¨ç½²">éƒ¨ç½²</a> â€¢
  <a href="#é‚®ç®±åŸŸåé…ç½®">é‚®ç®±åŸŸåé…ç½®</a> â€¢
  <a href="#æƒé™ç³»ç»Ÿ">æƒé™ç³»ç»Ÿ</a> â€¢
  <a href="#ç³»ç»Ÿè®¾ç½®">ç³»ç»Ÿè®¾ç½®</a> â€¢
  <a href="#å‘ä»¶åŠŸèƒ½">å‘ä»¶åŠŸèƒ½</a> â€¢
  <a href="#Webhook é›†æˆ">Webhook é›†æˆ</a> â€¢
  <a href="#OpenAPI">OpenAPI</a> â€¢
  <a href="#ç¯å¢ƒå˜é‡">ç¯å¢ƒå˜é‡</a> â€¢
  <a href="#Github OAuth App é…ç½®">Github OAuth App é…ç½®</a> â€¢
  <a href="#Google OAuth App é…ç½®">Google OAuth App é…ç½®</a> â€¢
  <a href="#è´¡çŒ®">è´¡çŒ®</a> â€¢
  <a href="#è®¸å¯è¯">è®¸å¯è¯</a> â€¢
  <a href="#äº¤æµç¾¤">äº¤æµç¾¤</a> â€¢
  <a href="#æ”¯æŒ">æ”¯æŒ</a>
</p>

## åœ¨çº¿æ¼”ç¤º
[https://moemail.app](https://moemail.app)

![é¦–é¡µ](https://pic.otaku.ren/20241209/AQADwsUxG9k1uVZ-.jpg "é¦–é¡µ")


![é‚®ç®±](https://pic.otaku.ren/20241209/AQADw8UxG9k1uVZ-.jpg "é‚®ç®±")

![ä¸ªäººä¸­å¿ƒ](https://pic.otaku.ren/20241227/AQADVsIxG7OzcFd-.jpg "ä¸ªäººä¸­å¿ƒ")

## æ–‡æ¡£
**å®Œæ•´æ–‡æ¡£**: [https://docs.moemail.app](https://docs.moemail.app)

æ–‡æ¡£ç«™ç‚¹åŒ…å«è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—ã€API æ–‡æ¡£ã€éƒ¨ç½²æ•™ç¨‹ç­‰å®Œæ•´ä¿¡æ¯ã€‚

## ç‰¹æ€§

- ğŸ”’ **éšç§ä¿æŠ¤**ï¼šä¿æŠ¤æ‚¨çš„çœŸå®é‚®ç®±åœ°å€ï¼Œè¿œç¦»åƒåœ¾é‚®ä»¶å’Œä¸å¿…è¦çš„è®¢é˜…
- âš¡ **å®æ—¶æ”¶ä»¶**ï¼šè‡ªåŠ¨è½®è¯¢ï¼Œå³æ—¶æ¥æ”¶é‚®ä»¶é€šçŸ¥
- â±ï¸ **çµæ´»æœ‰æ•ˆæœŸ**ï¼šæ”¯æŒ 1 å°æ—¶ã€24 å°æ—¶ã€3 å¤©æˆ–æ°¸ä¹…æœ‰æ•ˆ
- ğŸ¨ **ä¸»é¢˜åˆ‡æ¢**ï¼šæ”¯æŒäº®è‰²å’Œæš—è‰²æ¨¡å¼
- ğŸ“± **å“åº”å¼è®¾è®¡**ï¼šå®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡
- ğŸ”„ **è‡ªåŠ¨æ¸…ç†**ï¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„é‚®ç®±å’Œé‚®ä»¶
- ğŸ“± **PWA æ”¯æŒ**ï¼šæ”¯æŒ PWA å®‰è£…
- ğŸ’¸ **å…è´¹è‡ªéƒ¨ç½²**ï¼šåŸºäº Cloudflare æ„å»º, å¯å®ç°å…è´¹è‡ªéƒ¨ç½²ï¼Œæ— éœ€ä»»ä½•è´¹ç”¨
- ğŸ‰ **å¯çˆ±çš„ UI**ï¼šç®€æ´å¯çˆ±èŒèŒå“’ UI ç•Œé¢
- ğŸ“¤ **å‘ä»¶åŠŸèƒ½**ï¼šæ”¯æŒä½¿ç”¨ä¸´æ—¶é‚®ç®±å‘é€é‚®ä»¶ï¼ŒåŸºäº Resend æœåŠ¡
- ğŸ”” **Webhook é€šçŸ¥**ï¼šæ”¯æŒé€šè¿‡ webhook æ¥æ”¶æ–°é‚®ä»¶é€šçŸ¥
- ğŸ›¡ï¸ **æƒé™ç³»ç»Ÿ**ï¼šæ”¯æŒåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ç³»ç»Ÿ
- ğŸ”‘ **OpenAPI**ï¼šæ”¯æŒé€šè¿‡ API Key è®¿é—® OpenAPI
- ğŸŒ **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ”¯æŒä¸­æ–‡å’Œè‹±æ–‡ç•Œé¢ï¼Œå¯è‡ªç”±åˆ‡æ¢

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: [Next.js](https://nextjs.org/) (App Router)
- **å¹³å°**: [Cloudflare Pages](https://pages.cloudflare.com/)
- **æ•°æ®åº“**: [Cloudflare D1](https://developers.cloudflare.com/d1/) (SQLite)
- **è®¤è¯**: [NextAuth](https://authjs.dev/getting-started/installation?framework=Next.js) é…åˆ GitHub ç™»å½•
- **æ ·å¼**: [Tailwind CSS](https://tailwindcss.com/)
- **UI ç»„ä»¶**: åŸºäº [Radix UI](https://www.radix-ui.com/) çš„è‡ªå®šä¹‰ç»„ä»¶
- **é‚®ä»¶å¤„ç†**: [Cloudflare Email Workers](https://developers.cloudflare.com/email-routing/)
- **ç±»å‹å®‰å…¨**: [TypeScript](https://www.typescriptlang.org/)
- **ORM**: [Drizzle ORM](https://orm.drizzle.team/)
- **å›½é™…åŒ–**: [next-intl](https://next-intl-docs.vercel.app/) æ”¯æŒå¤šè¯­è¨€

## æœ¬åœ°è¿è¡Œ

### å‰ç½®è¦æ±‚

- Node.js 18+
- Pnpm
- Wrangler CLI
- Cloudflare è´¦å·

### å®‰è£…

1. å…‹éš†ä»“åº“ï¼š
```bash
git clone https://github.com/beilunyang/moemail.git
cd moemail
```

2. å®‰è£…ä¾èµ–ï¼š
```bash
pnpm install
```

3. è®¾ç½® wranglerï¼š
```bash
cp wrangler.example.json wrangler.json
cp wrangler.email.example.json wrangler.email.json
cp wrangler.cleanup.example.json wrangler.cleanup.json
```
è®¾ç½® Cloudflare D1 æ•°æ®åº“åä»¥åŠæ•°æ®åº“ ID

4. è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
cp .env.example .env.local
```
è®¾ç½® AUTH_GITHUB_ID, AUTH_GITHUB_SECRET, AUTH_SECRET

5. åˆ›å»ºæœ¬åœ°æ•°æ®åº“è¡¨ç»“æ„
```bash
pnpm db:migrate-local
```

### å¼€å‘

1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š
```bash
pnpm dev
```

2. æµ‹è¯•é‚®ä»¶ workerï¼š
ç›®å‰æ— æ³•æœ¬åœ°è¿è¡Œå¹¶æµ‹è¯•ï¼Œè¯·ä½¿ç”¨ wrangler éƒ¨ç½²é‚®ä»¶ worker å¹¶æµ‹è¯•
```bash
pnpm deploy:email
```

3. æµ‹è¯•æ¸…ç† workerï¼š
```bash
pnpm dev:cleanup
pnpm test:cleanup
```

4. ç”Ÿæˆ Mock æ•°æ®ï¼ˆé‚®ç®±ä»¥åŠé‚®ä»¶æ¶ˆæ¯ï¼‰
```bash
pnpm generate-test-data
```
## éƒ¨ç½²

### è§†é¢‘ç‰ˆä¿å§†çº§éƒ¨ç½²æ•™ç¨‹
https://www.bilibili.com/video/BV19wrXY2ESM/

### æœ¬åœ° Wrangler éƒ¨ç½²
1. åˆ›å»º .env æ–‡ä»¶
```bash
cp .env.example .env
```
2. åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½®[ç¯å¢ƒå˜é‡](#ç¯å¢ƒå˜é‡)

3. è¿è¡Œéƒ¨ç½²è„šæœ¬
```bash
pnpm dlx tsx ./scripts/deploy/index.ts
```

### Github Actions éƒ¨ç½²

æœ¬é¡¹ç›®å¯ä½¿ç”¨ GitHub Actions å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚æ”¯æŒä»¥ä¸‹è§¦å‘æ–¹å¼ï¼š

1. **è‡ªåŠ¨è§¦å‘**ï¼šæ¨é€æ–°çš„ tag æ—¶è‡ªåŠ¨è§¦å‘éƒ¨ç½²æµç¨‹
2. **æ‰‹åŠ¨è§¦å‘**ï¼šåœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è§¦å‘

#### éƒ¨ç½²æ­¥éª¤

1. åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹ Secretsï¼š
   - `CLOUDFLARE_API_TOKEN`: Cloudflare API ä»¤ç‰Œ
   - `CLOUDFLARE_ACCOUNT_ID`: Cloudflare è´¦æˆ· ID
   - `AUTH_GITHUB_ID`: GitHub OAuth App ID
   - `AUTH_GITHUB_SECRET`: GitHub OAuth App Secret
   - `AUTH_SECRET`: NextAuth Secretï¼Œç”¨æ¥åŠ å¯† sessionï¼Œè¯·è®¾ç½®ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²
   - `CUSTOM_DOMAIN`: ç½‘ç«™è‡ªå®šä¹‰åŸŸåï¼Œç”¨äºè®¿é—® MoeMail (å¯é€‰ï¼Œ å¦‚æœä¸å¡«, åˆ™ä¼šä½¿ç”¨ Cloudflare Pages é»˜è®¤åŸŸå)
   - `PROJECT_NAME`: Pages é¡¹ç›®å ï¼ˆå¯é€‰ï¼Œå¦‚æœä¸å¡«ï¼Œåˆ™ä¸º moemailï¼‰ 
   - `DATABASE_NAME`: D1 æ•°æ®åº“åç§° (å¯é€‰ï¼Œå¦‚æœä¸å¡«ï¼Œåˆ™ä¸º moemail-db)
   - `KV_NAMESPACE_NAME`: Cloudflare KV namespace åç§°ï¼Œç”¨äºå­˜å‚¨ç½‘ç«™é…ç½® ï¼ˆå¯é€‰ï¼Œå¦‚æœä¸å¡«ï¼Œåˆ™ä¸º moemail-kvï¼‰

2. é€‰æ‹©è§¦å‘æ–¹å¼ï¼š

   **æ–¹å¼ä¸€ï¼šæ¨é€ tag è§¦å‘**
   ```bash
   # åˆ›å»ºæ–°çš„ tag
   git tag v1.0.0
   
   # æ¨é€ tag åˆ°è¿œç¨‹ä»“åº“
   git push origin v1.0.0
   ```

   **æ–¹å¼äºŒï¼šæ‰‹åŠ¨è§¦å‘**
   - è¿›å…¥ä»“åº“çš„ Actions é¡µé¢
   - é€‰æ‹© "Deploy" workflow
   - ç‚¹å‡» "Run workflow"

3. éƒ¨ç½²è¿›åº¦å¯ä»¥åœ¨ä»“åº“çš„ Actions æ ‡ç­¾é¡µæŸ¥çœ‹

#### æ³¨æ„äº‹é¡¹
- ç¡®ä¿æ‰€æœ‰ Secrets éƒ½å·²æ­£ç¡®è®¾ç½®
- ä½¿ç”¨ tag è§¦å‘æ—¶ï¼Œtag å¿…é¡»ä»¥ `v` å¼€å¤´ï¼ˆä¾‹å¦‚ï¼šv1.0.0ï¼‰

[![Deploy to Cloudflare Workers](https://deploy.workers.cloudflare.com/button)](https://deploy.workers.cloudflare.com/?url=https://github.com/beilunyang/moemail)


## é‚®ç®±åŸŸåé…ç½®

åœ¨ MoeMail ä¸ªäººä¸­å¿ƒé¡µé¢ï¼Œå¯ä»¥é…ç½®ç½‘ç«™çš„é‚®ç®±åŸŸåï¼Œæ”¯æŒå¤šåŸŸåé…ç½®ï¼Œå¤šä¸ªåŸŸåç”¨é€—å·åˆ†éš”
![é‚®ç®±åŸŸåé…ç½®](https://pic.otaku.ren/20241227/AQAD88AxG67zeVd-.jpg "é‚®ç®±åŸŸåé…ç½®")

### Cloudflare é‚®ä»¶è·¯ç”±é…ç½®

ä¸ºäº†ä½¿é‚®ç®±åŸŸåç”Ÿæ•ˆï¼Œè¿˜éœ€è¦åœ¨ Cloudflare æ§åˆ¶å°é…ç½®é‚®ä»¶è·¯ç”±ï¼Œå°†æ”¶åˆ°çš„é‚®ä»¶è½¬å‘ç»™ Email Worker å¤„ç†ã€‚

1. ç™»å½• [Cloudflare æ§åˆ¶å°](https://dash.cloudflare.com/)
2. é€‰æ‹©æ‚¨çš„åŸŸå
3. ç‚¹å‡»å·¦ä¾§èœå•çš„ "ç”µå­é‚®ä»¶" -> "ç”µå­é‚®ä»¶è·¯ç”±"
4. å¦‚æœæ˜¾ç¤º â€œç”µå­é‚®ä»¶è·¯ç”±å½“å‰è¢«ç¦ç”¨ï¼Œæ²¡æœ‰åœ¨è·¯ç”±ç”µå­é‚®ä»¶â€ï¼Œè¯·ç‚¹å‡» "å¯ç”¨ç”µå­é‚®ä»¶è·¯ç”±"
![å¯ç”¨ç”µå­é‚®ä»¶è·¯ç”±](https://pic.otaku.ren/20241223/AQADNcQxG_K0SVd-.jpg "å¯ç”¨ç”µå­é‚®ä»¶è·¯ç”±")
5. ç‚¹å‡»åï¼Œä¼šæç¤ºä½ æ·»åŠ ç”µå­é‚®ä»¶è·¯ç”± DNS è®°å½•ï¼Œç‚¹å‡» â€œæ·»åŠ è®°å½•å¹¶å¯ç”¨â€ å³å¯
![æ·»åŠ ç”µå­é‚®ä»¶è·¯ç”± DNS è®°å½•](https://pic.otaku.ren/20241223/AQADN8QxG_K0SVd-.jpg "æ·»åŠ ç”µå­é‚®ä»¶è·¯ç”± DNS è®°å½•")
6. é…ç½®è·¯ç”±è§„åˆ™ï¼š
   - Catch-all åœ°å€: å¯ç”¨ "Catch-all"
   - ç¼–è¾‘ Catch-all åœ°å€
    - æ“ä½œ: é€‰æ‹© "å‘é€åˆ° Worker"
    - ç›®æ ‡ä½ç½®: é€‰æ‹©åˆšåˆšéƒ¨ç½²çš„ "email-receiver-worker"
    - ä¿å­˜
  ![é…ç½®è·¯ç”±è§„åˆ™](https://pic.otaku.ren/20241223/AQADNsQxG_K0SVd-.jpg "é…ç½®è·¯ç”±è§„åˆ™")

### æ³¨æ„äº‹é¡¹
- ç¡®ä¿åŸŸåçš„ DNS æ‰˜ç®¡åœ¨ Cloudflare
- Email Worker å¿…é¡»å·²ç»éƒ¨ç½²æˆåŠŸ
- å¦‚æœ Catch-All çŠ¶æ€ä¸å¯ç”¨(ä¸€ç›´ loading)ï¼Œè¯·ç‚¹å‡»`è·¯ç”±è§„åˆ™`æ—è¾¹çš„`ç›®æ ‡åœ°å€`, è¿›å»ç»‘å®šä¸€ä¸ªé‚®ç®±

## æƒé™ç³»ç»Ÿ

æœ¬é¡¹ç›®é‡‡ç”¨åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ç³»ç»Ÿï¼ˆRBACï¼‰ã€‚

### è§’è‰²é…ç½®

æ–°ç”¨æˆ·é»˜è®¤è§’è‰²ç”±çš‡å¸åœ¨ä¸ªäººä¸­å¿ƒçš„ç½‘ç«™è®¾ç½®ä¸­é…ç½®ï¼š
- å…¬çˆµï¼šæ–°ç”¨æˆ·å°†è·å¾—ä¸´æ—¶é‚®ç®±ã€Webhook é…ç½®æƒé™ä»¥åŠ API Key ç®¡ç†æƒé™
- éª‘å£«ï¼šæ–°ç”¨æˆ·å°†è·å¾—ä¸´æ—¶é‚®ç®±å’Œ Webhook é…ç½®æƒé™
- å¹³æ°‘ï¼šæ–°ç”¨æˆ·æ— ä»»ä½•æƒé™ï¼Œéœ€è¦ç­‰å¾…çš‡å¸å†Œå°ä¸ºéª‘å£«æˆ–å…¬çˆµ

### è§’è‰²ç­‰çº§

ç³»ç»ŸåŒ…å«å››ä¸ªè§’è‰²ç­‰çº§ï¼š

1. **çš‡å¸ï¼ˆEmperorï¼‰**
   - ç½‘ç«™æ‰€æœ‰è€…
   - æ‹¥æœ‰æ‰€æœ‰æƒé™
   - æ¯ä¸ªç«™ç‚¹åªèƒ½æœ‰ä¸€ä¸ªçš‡å¸

2. **å…¬çˆµï¼ˆDukeï¼‰**  
   - è¶…çº§ç”¨æˆ·
   - å¯ä»¥ä½¿ç”¨ä¸´æ—¶é‚®ç®±åŠŸèƒ½
   - å¯ä»¥é…ç½® Webhook
   - å¯ä»¥ä½¿ç”¨åˆ›å»º API Key è°ƒç”¨ OpenAPI
   - å¯ä»¥è¢«çš‡å¸è´¬ä¸ºéª‘å£«æˆ–å¹³æ°‘

3. **éª‘å£«ï¼ˆKnightï¼‰**
   - é«˜çº§ç”¨æˆ·
   - å¯ä»¥ä½¿ç”¨ä¸´æ—¶é‚®ç®±åŠŸèƒ½
   - å¯ä»¥é…ç½® Webhook
   - å¯ä»¥è¢«çš‡å¸è´¬ä¸ºå¹³æ°‘æˆ–å†Œå°ä¸ºå…¬çˆµ

3. **å¹³æ°‘ï¼ˆCivilianï¼‰**
   - æ™®é€šç”¨æˆ·
   - æ— ä»»ä½•æƒé™
   - å¯ä»¥è¢«çš‡å¸å†Œå°ä¸ºéª‘å£«æˆ–è€…å…¬çˆµ

### è§’è‰²å‡çº§

1. **æˆä¸ºçš‡å¸**
   - ç¬¬ä¸€ä¸ªè®¿é—® `/api/roles/init-emperor` æ¥å£çš„ç”¨æˆ·å°†æˆä¸ºçš‡å¸ï¼Œå³ç½‘ç«™æ‰€æœ‰è€…
   - ç«™ç‚¹å·²æœ‰çš‡å¸åï¼Œæ— æ³•å†æå‡å…¶ä»–ç”¨æˆ·ä¸ºçš‡å¸

2. **è§’è‰²å˜æ›´**
   - çš‡å¸å¯ä»¥åœ¨ä¸ªäººä¸­å¿ƒé¡µé¢å°†å…¶ä»–ç”¨æˆ·è®¾ä¸ºå…¬çˆµã€éª‘å£«æˆ–å¹³æ°‘

### æƒé™è¯´æ˜

- **é‚®ç®±ç®¡ç†**ï¼šåˆ›å»ºå’Œç®¡ç†ä¸´æ—¶é‚®ç®±
- **Webhook ç®¡ç†**ï¼šé…ç½®é‚®ä»¶é€šçŸ¥çš„ Webhook
- **API Key ç®¡ç†**ï¼šåˆ›å»ºå’Œç®¡ç† API è®¿é—®å¯†é’¥
- **ç”¨æˆ·ç®¡ç†**ï¼šå‡é™ç”¨æˆ·è§’è‰²
- **ç³»ç»Ÿè®¾ç½®**ï¼šç®¡ç†ç³»ç»Ÿå…¨å±€è®¾ç½®

## ç³»ç»Ÿè®¾ç½®

ç³»ç»Ÿè®¾ç½®å­˜å‚¨åœ¨ Cloudflare KV ä¸­ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š

- `DEFAULT_ROLE`: æ–°æ³¨å†Œç”¨æˆ·é»˜è®¤è§’è‰²ï¼Œå¯é€‰å€¼ä¸º `CIVILIAN`ã€`KNIGHT`ã€`DUKE`
- `EMAIL_DOMAINS`: æ”¯æŒçš„é‚®ç®±åŸŸåï¼Œå¤šä¸ªåŸŸåç”¨é€—å·åˆ†éš”
- `ADMIN_CONTACT`: ç®¡ç†å‘˜è”ç³»æ–¹å¼
- `MAX_EMAILS`: æ¯ä¸ªç”¨æˆ·å¯åˆ›å»ºçš„æœ€å¤§é‚®ç®±æ•°é‡

**çš‡å¸**è§’è‰²å¯ä»¥åœ¨ä¸ªäººä¸­å¿ƒé¡µé¢è®¾ç½®

## å‘ä»¶åŠŸèƒ½

MoeMail æ”¯æŒä½¿ç”¨ä¸´æ—¶é‚®ç®±å‘é€é‚®ä»¶ï¼ŒåŸºäº [Resend](https://resend.com/) æœåŠ¡ã€‚

### åŠŸèƒ½ç‰¹æ€§

- ğŸ“¨ **ä¸´æ—¶é‚®ç®±å‘ä»¶**ï¼šå¯ä»¥ä½¿ç”¨åˆ›å»ºçš„ä¸´æ—¶é‚®ç®±ä½œä¸ºå‘ä»¶äººå‘é€é‚®ä»¶
- ğŸ¯ **è§’è‰²æƒé™æ§åˆ¶**ï¼šä¸åŒè§’è‰²æœ‰ä¸åŒçš„æ¯æ—¥å‘ä»¶é™åˆ¶
- ğŸ’Œ **æ”¯æŒ HTML**ï¼šæ”¯æŒå‘é€å¯Œæ–‡æœ¬æ ¼å¼é‚®ä»¶

### è§’è‰²å‘ä»¶æƒé™

| è§’è‰² | æ¯æ—¥å‘ä»¶é™åˆ¶ | è¯´æ˜ |
|------|-------------|------|
| çš‡å¸ (Emperor) | æ— é™åˆ¶ | ç½‘ç«™ç®¡ç†å‘˜ï¼Œæ— å‘ä»¶é™åˆ¶ |
| å…¬çˆµ (Duke) | 5å°/å¤© | é»˜è®¤æ¯æ—¥å¯å‘é€5å°é‚®ä»¶ |
| éª‘å£« (Knight) | 2å°/å¤© | é»˜è®¤æ¯æ—¥å¯å‘é€2å°é‚®ä»¶ |
| å¹³æ°‘ (Civilian) | ç¦æ­¢å‘ä»¶ | æ— å‘ä»¶æƒé™ |

> ğŸ’¡ **æç¤º**ï¼šçš‡å¸å¯ä»¥åœ¨ä¸ªäººä¸­å¿ƒçš„é‚®ä»¶æœåŠ¡é…ç½®ä¸­è‡ªå®šä¹‰å…¬çˆµå’Œéª‘å£«çš„æ¯æ—¥å‘ä»¶é™åˆ¶ã€‚

### é…ç½®å‘ä»¶æœåŠ¡

1. **è·å– Resend API Key**
   - è®¿é—® [Resend å®˜ç½‘](https://resend.com/) æ³¨å†Œè´¦å·
   - åœ¨æ§åˆ¶å°ä¸­åˆ›å»º API Key
   - å¤åˆ¶ API Key ä¾›åç»­é…ç½®ä½¿ç”¨

2. **é…ç½®å‘ä»¶æœåŠ¡**
   - çš‡å¸è§’è‰²ç™»å½• MoeMail
   - è¿›å…¥ä¸ªäººä¸­å¿ƒé¡µé¢
   - åœ¨"Resend å‘ä»¶æœåŠ¡é…ç½®"éƒ¨åˆ†ï¼š
     - å¯ç”¨å‘ä»¶æœåŠ¡å¼€å…³
     - å¡«å…¥ Resend API Key
     - è®¾ç½®å…¬çˆµå’Œéª‘å£«çš„æ¯æ—¥å‘ä»¶é™åˆ¶ï¼ˆå¯é€‰ï¼‰
   - ç‚¹å‡»ä¿å­˜é…ç½®

3. **éªŒè¯é…ç½®**
   - é…ç½®ä¿å­˜åï¼Œæœ‰æƒé™çš„ç”¨æˆ·åœ¨é‚®ç®±åˆ—è¡¨é¡µé¢ä¼šçœ‹åˆ°"å‘é€é‚®ä»¶"æŒ‰é’®
   - ç‚¹å‡»æŒ‰é’®å¯ä»¥æ‰“å¼€å‘ä»¶å¯¹è¯æ¡†è¿›è¡Œæµ‹è¯•

### ä½¿ç”¨å‘ä»¶åŠŸèƒ½

1. **åˆ›å»ºä¸´æ—¶é‚®ç®±**
   - åœ¨é‚®ç®±é¡µé¢åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸´æ—¶é‚®ç®±

2. **å‘é€é‚®ä»¶**
   - åœ¨é‚®ç®±åˆ—è¡¨ä¸­æ‰¾åˆ°è¦ä½¿ç”¨çš„é‚®ç®±
   - ç‚¹å‡»é‚®ç®±æ—è¾¹çš„"å‘é€é‚®ä»¶"æŒ‰é’®
   - åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­å¡«å†™ï¼š
     - æ”¶ä»¶äººé‚®ç®±åœ°å€
     - é‚®ä»¶ä¸»é¢˜
     - é‚®ä»¶å†…å®¹ï¼ˆæ”¯æŒ HTML æ ¼å¼ï¼‰
   - ç‚¹å‡»"å‘é€"æŒ‰é’®

3. **æŸ¥çœ‹å‘é€è®°å½•**
   - å‘é€çš„é‚®ä»¶ä¼šè‡ªåŠ¨ä¿å­˜åˆ°å¯¹åº”é‚®ç®±çš„æ¶ˆæ¯åˆ—è¡¨ä¸­
   - å¯ä»¥åœ¨é‚®ç®±è¯¦æƒ…é¡µé¢æŸ¥çœ‹æ‰€æœ‰å‘é€å’Œæ¥æ”¶çš„é‚®ä»¶

### æ³¨æ„äº‹é¡¹

- ğŸ“‹ **Resend é™åˆ¶**ï¼šè¯·æ³¨æ„ Resend æœåŠ¡çš„å‘é€é™åˆ¶å’Œå®šä»·æ”¿ç­–
- ğŸ” **åŸŸåéªŒè¯**ï¼šä½¿ç”¨è‡ªå®šä¹‰åŸŸåå‘ä»¶éœ€è¦åœ¨ Resend ä¸­éªŒè¯åŸŸå
- ğŸš« **ååƒåœ¾é‚®ä»¶**ï¼šè¯·éµå®ˆé‚®ä»¶å‘é€è§„èŒƒï¼Œé¿å…å‘é€åƒåœ¾é‚®ä»¶
- ğŸ“Š **é…é¢ç›‘æ§**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨ç»Ÿè®¡æ¯æ—¥å‘ä»¶æ•°é‡ï¼Œè¾¾åˆ°é™é¢åå°†æ— æ³•ç»§ç»­å‘é€
- ğŸ”„ **é…é¢é‡ç½®**ï¼šæ¯æ—¥å‘ä»¶é…é¢åœ¨æ¯å¤© 00:00 è‡ªåŠ¨é‡ç½®

## Webhook é›†æˆ

å½“æ”¶åˆ°æ–°é‚®ä»¶æ—¶ï¼Œç³»ç»Ÿä¼šå‘ç”¨æˆ·é…ç½®å¹¶ä¸”å·²å¯ç”¨çš„ Webhook URL å‘é€ POST è¯·æ±‚ã€‚

### è¯·æ±‚å¤´
```http
Content-Type: application/json
X-Webhook-Event: new_message
```

### è¯·æ±‚ä½“
```json
{
  "emailId": "email-uuid",
  "messageId": "message-uuid",
  "fromAddress": "sender@example.com",
  "subject": "é‚®ä»¶ä¸»é¢˜",
  "content": "é‚®ä»¶æ–‡æœ¬å†…å®¹",
  "html": "é‚®ä»¶HTMLå†…å®¹",
  "receivedAt": "2024-01-01T12:00:00.000Z",
  "toAddress": "your-email@moemail.app"
}
```

### é…ç½®è¯´æ˜
1. ç‚¹å‡»ä¸ªäººå¤´åƒï¼Œè¿›å…¥ä¸ªäººä¸­å¿ƒ
2. åœ¨ä¸ªäººä¸­å¿ƒå¯ç”¨ Webhook
3. è®¾ç½®æ¥æ”¶é€šçŸ¥çš„ URL
4. ç‚¹å‡»æµ‹è¯•æŒ‰é’®éªŒè¯é…ç½®
5. ä¿å­˜é…ç½®åå³å¯æ¥æ”¶æ–°é‚®ä»¶é€šçŸ¥

### æµ‹è¯•

é¡¹ç›®æä¾›äº†ä¸€ä¸ªç®€å•çš„æµ‹è¯•æœåŠ¡å™¨, å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿è¡Œ:

```bash
pnpm webhook-test-server
```

æµ‹è¯•æœåŠ¡å™¨ä¼šåœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œç›‘å¬ 3001 ç«¯å£ï¼ˆhttp://localhost:3001ï¼‰, å¹¶æ‰“å°æ”¶åˆ°çš„ Webhook æ¶ˆæ¯è¯¦æƒ…ã€‚

å¦‚æœéœ€è¦è¿›è¡Œå¤–ç½‘æµ‹è¯•ï¼Œå¯ä»¥é€šè¿‡ Cloudflare Tunnel å°†æœåŠ¡æš´éœ²åˆ°å¤–ç½‘ï¼š
```bash
pnpx cloudflared tunnel --url http://localhost:3001
```

### æ³¨æ„äº‹é¡¹
- Webhook æ¥å£åº”åœ¨ 10 ç§’å†…å“åº”
- é 2xx å“åº”ç ä¼šè§¦å‘é‡è¯•

## OpenAPI

æœ¬é¡¹ç›®æä¾›äº† OpenAPI æ¥å£ï¼Œæ”¯æŒé€šè¿‡ API Key è¿›è¡Œè®¿é—®ã€‚API Key å¯ä»¥åœ¨ä¸ªäººä¸­å¿ƒé¡µé¢åˆ›å»ºï¼ˆéœ€è¦æ˜¯å…¬çˆµæˆ–çš‡å¸è§’è‰²ï¼‰ã€‚

### ä½¿ç”¨ API Key

åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  API Keyï¼š
```http
X-API-Key: YOUR_API_KEY
```

### API æ¥å£

#### è·å–ç³»ç»Ÿé…ç½®
```http
GET /api/config
```
è¿”å›å“åº”ï¼š
```json
{
  "defaultRole": "CIVILIAN",
  "emailDomains": "moemail.app,example.com",
  "adminContact": "admin@example.com",
  "maxEmails": "10"
}
```
å“åº”å­—æ®µè¯´æ˜ï¼š
- `defaultRole`: æ–°ç”¨æˆ·é»˜è®¤è§’è‰²ï¼Œå¯é€‰å€¼ï¼š`CIVILIAN`ï¼ˆå¹³æ°‘ï¼‰ã€`KNIGHT`ï¼ˆéª‘å£«ï¼‰ã€`DUKE`ï¼ˆå…¬çˆµï¼‰
- `emailDomains`: æ”¯æŒçš„é‚®ç®±åŸŸåï¼Œå¤šä¸ªåŸŸåç”¨é€—å·åˆ†éš”
- `adminContact`: ç®¡ç†å‘˜è”ç³»æ–¹å¼
- `maxEmails`: æ¯ä¸ªç”¨æˆ·å¯åˆ›å»ºçš„æœ€å¤§é‚®ç®±æ•°é‡

#### åˆ›å»ºä¸´æ—¶é‚®ç®±
```http
POST /api/emails/generate
Content-Type: application/json

{
  "name": "test",
  "expiryTime": 3600000,
  "domain": "moemail.app"
}
```
å‚æ•°è¯´æ˜ï¼š
- `name`: é‚®ç®±å‰ç¼€ï¼Œå¯é€‰
- `expiryTime`: æœ‰æ•ˆæœŸï¼ˆæ¯«ç§’ï¼‰ï¼Œå¯é€‰å€¼ï¼š3600000ï¼ˆ1å°æ—¶ï¼‰ã€86400000ï¼ˆ1å¤©ï¼‰ã€604800000ï¼ˆ7å¤©ï¼‰ã€0ï¼ˆæ°¸ä¹…ï¼‰
- `domain`: é‚®ç®±åŸŸåï¼Œå¯é€šè¿‡ `/api/config` æ¥å£è·å–

è¿”å›å“åº”ï¼š
```json
{
  "id": "email-uuid-123",
  "email": "test@moemail.app"
}
```
å“åº”å­—æ®µè¯´æ˜ï¼š
- `id`: é‚®ç®±çš„å”¯ä¸€æ ‡è¯†ç¬¦
- `email`: åˆ›å»ºçš„é‚®ç®±åœ°å€

#### è·å–é‚®ç®±åˆ—è¡¨
```http
GET /api/emails?cursor=xxx
```
å‚æ•°è¯´æ˜ï¼š
- `cursor`: åˆ†é¡µæ¸¸æ ‡ï¼Œå¯é€‰

è¿”å›å“åº”ï¼š
```json
{
  "emails": [
    {
      "id": "email-uuid-123",
      "address": "test@moemail.app",
      "createdAt": "2024-01-01T12:00:00.000Z",
      "expiresAt": "2024-01-02T12:00:00.000Z",
      "userId": "user-uuid-456"
    }
  ],
  "nextCursor": "encoded-cursor-string",
  "total": 5
}
```
å“åº”å­—æ®µè¯´æ˜ï¼š
- `emails`: é‚®ç®±åˆ—è¡¨æ•°ç»„
- `nextCursor`: ä¸‹ä¸€é¡µæ¸¸æ ‡ï¼Œç”¨äºåˆ†é¡µè¯·æ±‚
- `total`: é‚®ç®±æ€»æ•°é‡

#### è·å–æŒ‡å®šé‚®ç®±é‚®ä»¶åˆ—è¡¨
```http
GET /api/emails/{emailId}?cursor=xxx
```
å‚æ•°è¯´æ˜ï¼š
- `emailId`: é‚®ç®±çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«
- `cursor`: åˆ†é¡µæ¸¸æ ‡ï¼Œå¯é€‰

è¿”å›å“åº”ï¼š
```json
{
  "messages": [
    {
      "id": "message-uuid-789",
      "from_address": "sender@example.com",
      "subject": "é‚®ä»¶ä¸»é¢˜",
      "received_at": 1704110400000
    }
  ],
  "nextCursor": "encoded-cursor-string",
  "total": 3
}
```
å“åº”å­—æ®µè¯´æ˜ï¼š
- `messages`: é‚®ä»¶åˆ—è¡¨æ•°ç»„
- `nextCursor`: ä¸‹ä¸€é¡µæ¸¸æ ‡ï¼Œç”¨äºåˆ†é¡µè¯·æ±‚
- `total`: é‚®ä»¶æ€»æ•°é‡

#### åˆ é™¤é‚®ç®±
```http
DELETE /api/emails/{emailId}
```
å‚æ•°è¯´æ˜ï¼š
- `emailId`: é‚®ç®±çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«

è¿”å›å“åº”ï¼š
```json
{
  "success": true
}
```
å“åº”å­—æ®µè¯´æ˜ï¼š
- `success`: åˆ é™¤æ“ä½œæ˜¯å¦æˆåŠŸ

#### è·å–å•å°é‚®ä»¶å†…å®¹
```http
GET /api/emails/{emailId}/{messageId}
```
å‚æ•°è¯´æ˜ï¼š
- `emailId`: é‚®ç®±çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«
- `messageId`: é‚®ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«

è¿”å›å“åº”ï¼š
```json
{
  "message": {
    "id": "message-uuid-789",
    "from_address": "sender@example.com",
    "subject": "é‚®ä»¶ä¸»é¢˜",
    "content": "é‚®ä»¶æ–‡æœ¬å†…å®¹",
    "html": "<p>é‚®ä»¶HTMLå†…å®¹</p>",
    "received_at": 1704110400000
  }
}
```
å“åº”å­—æ®µè¯´æ˜ï¼š
- `message`: é‚®ä»¶è¯¦ç»†ä¿¡æ¯å¯¹è±¡
- `id`: é‚®ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦
- `from_address`: å‘ä»¶äººé‚®ç®±åœ°å€
- `subject`: é‚®ä»¶ä¸»é¢˜
- `content`: é‚®ä»¶çº¯æ–‡æœ¬å†…å®¹
- `html`: é‚®ä»¶HTMLå†…å®¹
- `received_at`: æ¥æ”¶æ—¶é—´ï¼ˆæ—¶é—´æˆ³ï¼‰

#### åˆ›å»ºé‚®ç®±åˆ†äº«é“¾æ¥
```http
POST /api/emails/{emailId}/share
Content-Type: application/json

{
  "expiresIn": 86400000
}
```
å‚æ•°è¯´æ˜ï¼š
- `emailId`: é‚®ç®±çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«
- `expiresIn`: åˆ†äº«é“¾æ¥æœ‰æ•ˆæœŸï¼ˆæ¯«ç§’ï¼‰ï¼Œ0 è¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆï¼Œå¯é€‰

è¿”å›å“åº”ï¼š
```json
{
  "id": "share-uuid-123",
  "emailId": "email-uuid-123",
  "token": "abc123def456",
  "expiresAt": "2024-01-02T12:00:00.000Z",
  "createdAt": "2024-01-01T12:00:00.000Z"
}
```
å“åº”å­—æ®µè¯´æ˜ï¼š
- `id`: åˆ†äº«è®°å½•çš„å”¯ä¸€æ ‡è¯†ç¬¦
- `emailId`: å…³è”çš„é‚®ç®± ID
- `token`: åˆ†äº«é“¾æ¥çš„è®¿é—®ä»¤ç‰Œ
- `expiresAt`: åˆ†äº«é“¾æ¥è¿‡æœŸæ—¶é—´ï¼Œnull è¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆ
- `createdAt`: åˆ›å»ºæ—¶é—´

åˆ†äº«é“¾æ¥è®¿é—®åœ°å€ï¼š`https://your-domain.com/shared/{token}`

#### è·å–é‚®ç®±çš„æ‰€æœ‰åˆ†äº«é“¾æ¥
```http
GET /api/emails/{emailId}/share
```
å‚æ•°è¯´æ˜ï¼š
- `emailId`: é‚®ç®±çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«

è¿”å›å“åº”ï¼š
```json
{
  "shares": [
    {
      "id": "share-uuid-123",
      "emailId": "email-uuid-123",
      "token": "abc123def456",
      "expiresAt": "2024-01-02T12:00:00.000Z",
      "createdAt": "2024-01-01T12:00:00.000Z"
    }
  ],
  "total": 1
}
```
å“åº”å­—æ®µè¯´æ˜ï¼š
- `shares`: åˆ†äº«é“¾æ¥åˆ—è¡¨æ•°ç»„
- `total`: åˆ†äº«é“¾æ¥æ€»æ•°

#### åˆ é™¤é‚®ç®±åˆ†äº«é“¾æ¥
```http
DELETE /api/emails/{emailId}/share/{shareId}
```
å‚æ•°è¯´æ˜ï¼š
- `emailId`: é‚®ç®±çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«
- `shareId`: åˆ†äº«è®°å½•çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«

è¿”å›å“åº”ï¼š
```json
{
  "success": true
}
```
å“åº”å­—æ®µè¯´æ˜ï¼š
- `success`: åˆ é™¤æ“ä½œæ˜¯å¦æˆåŠŸ

#### åˆ›å»ºé‚®ä»¶åˆ†äº«é“¾æ¥
```http
POST /api/emails/{emailId}/messages/{messageId}/share
Content-Type: application/json

{
  "expiresIn": 86400000
}
```
å‚æ•°è¯´æ˜ï¼š
- `emailId`: é‚®ç®±çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«
- `messageId`: é‚®ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«
- `expiresIn`: åˆ†äº«é“¾æ¥æœ‰æ•ˆæœŸï¼ˆæ¯«ç§’ï¼‰ï¼Œ0 è¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆï¼Œå¯é€‰

è¿”å›å“åº”ï¼š
```json
{
  "id": "share-uuid-456",
  "messageId": "message-uuid-789",
  "token": "xyz789ghi012",
  "expiresAt": "2024-01-02T12:00:00.000Z",
  "createdAt": "2024-01-01T12:00:00.000Z"
}
```
å“åº”å­—æ®µè¯´æ˜ï¼š
- `id`: åˆ†äº«è®°å½•çš„å”¯ä¸€æ ‡è¯†ç¬¦
- `messageId`: å…³è”çš„é‚®ä»¶ ID
- `token`: åˆ†äº«é“¾æ¥çš„è®¿é—®ä»¤ç‰Œ
- `expiresAt`: åˆ†äº«é“¾æ¥è¿‡æœŸæ—¶é—´ï¼Œnull è¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆ
- `createdAt`: åˆ›å»ºæ—¶é—´

åˆ†äº«é“¾æ¥è®¿é—®åœ°å€ï¼š`https://your-domain.com/shared/message/{token}`

#### è·å–é‚®ä»¶çš„æ‰€æœ‰åˆ†äº«é“¾æ¥
```http
GET /api/emails/{emailId}/messages/{messageId}/share
```
å‚æ•°è¯´æ˜ï¼š
- `emailId`: é‚®ç®±çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«
- `messageId`: é‚®ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«

è¿”å›å“åº”ï¼š
```json
{
  "shares": [
    {
      "id": "share-uuid-456",
      "messageId": "message-uuid-789",
      "token": "xyz789ghi012",
      "expiresAt": "2024-01-02T12:00:00.000Z",
      "createdAt": "2024-01-01T12:00:00.000Z"
    }
  ],
  "total": 1
}
```
å“åº”å­—æ®µè¯´æ˜ï¼š
- `shares`: åˆ†äº«é“¾æ¥åˆ—è¡¨æ•°ç»„
- `total`: åˆ†äº«é“¾æ¥æ€»æ•°

#### åˆ é™¤é‚®ä»¶åˆ†äº«é“¾æ¥
```http
DELETE /api/emails/{emailId}/messages/{messageId}/share/{shareId}
```
å‚æ•°è¯´æ˜ï¼š
- `emailId`: é‚®ç®±çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«
- `messageId`: é‚®ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«
- `shareId`: åˆ†äº«è®°å½•çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…å¡«

è¿”å›å“åº”ï¼š
```json
{
  "success": true
}
```
å“åº”å­—æ®µè¯´æ˜ï¼š
- `success`: åˆ é™¤æ“ä½œæ˜¯å¦æˆåŠŸ

### ä½¿ç”¨ç¤ºä¾‹

ä½¿ç”¨ curl åˆ›å»ºä¸´æ—¶é‚®ç®±ï¼š
```bash
curl -X POST https://your-domain.com/api/emails/generate \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "test",
    "expiryTime": 3600000,
    "domain": "moemail.app"
  }'
```

ä½¿ç”¨ JavaScript è·å–é‚®ä»¶åˆ—è¡¨ï¼š
```javascript
const res = await fetch('https://your-domain.com/api/emails/your-email-id', {
  headers: {
    'X-API-Key': 'YOUR_API_KEY'
  }
});
const data = await res.json();
```

ä½¿ç”¨ curl åˆ›å»ºé‚®ç®±åˆ†äº«é“¾æ¥ï¼š
```bash
curl -X POST https://your-domain.com/api/emails/your-email-id/share \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "expiresIn": 86400000
  }'
```

ä½¿ç”¨ JavaScript åˆ›å»ºé‚®ä»¶åˆ†äº«é“¾æ¥ï¼š
```javascript
const res = await fetch('https://your-domain.com/api/emails/your-email-id/messages/your-message-id/share', {
  method: 'POST',
  headers: {
    'X-API-Key': 'YOUR_API_KEY',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    expiresIn: 0  // æ°¸ä¹…æœ‰æ•ˆ
  })
});
const data = await res.json();
console.log('åˆ†äº«é“¾æ¥:', `https://your-domain.com/shared/message/${data.token}`);
```

## ç¯å¢ƒå˜é‡

æœ¬é¡¹ç›®ä½¿ç”¨ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

### è®¤è¯ç›¸å…³
- `AUTH_GITHUB_ID`: GitHub OAuth App ID
- `AUTH_GITHUB_SECRET`: GitHub OAuth App Secret
- `AUTH_GOOGLE_ID`: Google OAuth App ID
- `AUTH_GOOGLE_SECRET`: Google OAuth App Secret
- `AUTH_SECRET`: NextAuth Secretï¼Œç”¨æ¥åŠ å¯† sessionï¼Œè¯·è®¾ç½®ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²

### Cloudflare é…ç½®
- `CLOUDFLARE_API_TOKEN`: Cloudflare API Token
- `CLOUDFLARE_ACCOUNT_ID`: Cloudflare Account ID
- `DATABASE_NAME`: D1 æ•°æ®åº“åç§°
- `DATABASE_ID`: D1 æ•°æ®åº“ ID (å¯é€‰, å¦‚æœä¸å¡«, åˆ™ä¼šè‡ªåŠ¨é€šè¿‡ Cloudflare API è·å–)
- `KV_NAMESPACE_NAME`: Cloudflare KV namespace åç§°ï¼Œç”¨äºå­˜å‚¨ç½‘ç«™é…ç½®
- `KV_NAMESPACE_ID`: Cloudflare KV namespace IDï¼Œç”¨äºå­˜å‚¨ç½‘ç«™é…ç½® ï¼ˆå¯é€‰ï¼Œ å¦‚æœä¸å¡«, åˆ™ä¼šè‡ªåŠ¨é€šè¿‡ Cloudflare API è·å–ï¼‰
- `CUSTOM_DOMAIN`: ç½‘ç«™è‡ªå®šä¹‰åŸŸå, å¦‚ï¼šmoemail.app (å¯é€‰ï¼Œ å¦‚æœä¸å¡«, åˆ™ä¼šä½¿ç”¨ Cloudflare Pages é»˜è®¤åŸŸå)
- `PROJECT_NAME`: Pages é¡¹ç›®å ï¼ˆå¯é€‰ï¼Œå¦‚æœä¸å¡«ï¼Œåˆ™ä¸º moemailï¼‰ 

## Github OAuth App é…ç½®

1. ç™»å½• [Github Developer](https://github.com/settings/developers) åˆ›å»ºä¸€ä¸ªæ–°çš„ OAuth App
2. ç”Ÿæˆä¸€ä¸ªæ–°çš„ `Client ID` å’Œ `Client Secret`
3. é…ç½®å‚æ•°ï¼š
   - `Application name`: `<your-app-name>`
   - `Homepage URL`: `https://<your-domain>`
   - `Authorization callback URL`: `https://<your-domain>/api/auth/callback/github`

## Google OAuth App é…ç½®

1. è®¿é—® [Google Cloud Console](https://console.cloud.google.com/) åˆ›å»ºé¡¹ç›®
2. é…ç½® OAuth åŒæ„å±å¹•
3. åˆ›å»º OAuth å®¢æˆ·ç«¯ ID
   - åº”ç”¨ç±»å‹ï¼šWeb åº”ç”¨
   - å·²è·æˆæƒçš„ Javascript æ¥æºï¼š`https://<your-domain>`
   - å·²è·æˆæƒçš„é‡å®šå‘ URIï¼š`https://<your-domain>/api/auth/callback/google`
4. è·å– `Client ID` å’Œ `Client Secret`
5. é…ç½®ç¯å¢ƒå˜é‡ `AUTH_GOOGLE_ID` å’Œ `AUTH_GOOGLE_SECRET`



## è´¡çŒ®

æ¬¢è¿æäº¤ Pull Request æˆ–è€… Issue æ¥å¸®åŠ©æ”¹è¿›è¿™ä¸ªé¡¹ç›®

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT](LICENSE) è®¸å¯è¯

## äº¤æµ
<table>
  <tr style="max-width: 360px">
    <td>
      <img src="https://pic.otaku.ren/20250309/AQADAcQxGxQjaVZ-.jpg" />
    </td>
    <td>
      <img src="https://pic.otaku.ren/20250309/AQADCMQxGxQjaVZ-.jpg" />
    </td>
  </tr>
  <tr style="max-width: 360px">
    <td>
      å…³æ³¨å…¬ä¼—å·ï¼Œäº†è§£æ›´å¤šé¡¹ç›®è¿›å±•ä»¥åŠAIï¼ŒåŒºå—é“¾ï¼Œç‹¬ç«‹å¼€å‘èµ„è®¯
    </td>
    <td>
      æ·»åŠ å¾®ä¿¡ï¼Œå¤‡æ³¨ "MoeMail" æ‹‰ä½ è¿›å¾®ä¿¡äº¤æµç¾¤
    </td>
  </tr>
</table>

## æ”¯æŒ

å¦‚æœä½ å–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Œæ¬¢è¿ç»™å®ƒä¸€ä¸ª Star â­ï¸
æˆ–è€…è¿›è¡ŒèµåŠ©
<br />
<br />
<img src="https://pic.otaku.ren/20240212/AQADPrgxGwoIWFZ-.jpg" style="width: 400px;"/>
<br />
<br />
<a href="https://www.buymeacoffee.com/beilunyang" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-blue.png" alt="Buy Me A Coffee" style="width: 400px;" ></a>

## Star History

<a href="https://www.star-history.com/#beilunyang/moemail&Date">
 <picture>
   <source media="(prefers-color-scheme: dark)" srcset="https://api.star-history.com/svg?repos=beilunyang/moemail&type=Date&theme=dark" />
   <source media="(prefers-color-scheme: light)" srcset="https://api.star-history.com/svg?repos=beilunyang/moemail&type=Date" />
   <img alt="Star History Chart" src="https://api.star-history.com/svg?repos=beilunyang/moemail&type=Date" />
 </picture>
</a>
